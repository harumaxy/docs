---
slug: "a3f110bc-896e-4c81-a003-e2dca4a4c080"
title: "if_not_react_then_what"
published_at: "2024-12-15T00:13:31Z"
thumbnail: null # https://blog-images.harumaxy.com/*.png
draft: false
tags: []
---

https://infrequently.org/2024/11/if-not-react-then-what/

の和訳のような、まとめのような

## React はモダンではない

「モダン」芸術が、真の意味でモダンかどうか？ (当時は現代的だが、現代と比較すると旧時代的)

実はレガシーフレームワークの類に入っている 
だが、 Greenfield プロジェクトではスタック選定に必ずといっていいほど候補に上がる


## JS は減らすべき

- サーバー上のコードは完全にコスト計算できる
  - パフォーマンス、可用性はプロビジョニング組織のコントロールにあり、DevOps エンジニアによって積極的に管理される
- クライアント上で実行されるコードは制御できない
  - キャッシュがほとんど無く高遅延の狭い帯域、といった劣悪な回線でダウンロードされる
- ジェネラリストはカス
  - 開発者が所有しておらず、制御もできないデバイス上で優れたUXを提供することの難しさを理解していない (困難の過小評価)
  - クライアント側の制約を理解していない、尊重もしない
  - HTML 中心の Wikipedia や MDN のサイトの高速性という軌跡を実現しようとしない
  - 優れたUXと相容れない大量の思いJSを、狭い帯域につまらせる


## フレームワーク主義

ユーザーエクスペリエンスより、どのフレームワークを使うか？から始まる

そもそも Javascript はバグの元なのでユーザーにはできる限り出荷しない必要がある。  
最初に議論すべきは、SPA志向ツールが必要か否か。  
そして、多くのWebアプリケーションではSPAは不要

1. 10分以上のセッションが存在する？
2. 10回以上、プライマリデータがアップデートされる？
この２つを満たして初めて、多分必要かどうかになる。

多くのCTO, PMはアーキテクチャの理由や根拠を熟考せず人気のあるものを選ぶだけ
(自分たちの考えより、大衆が賢いと誤解する)

React 含めた全ての SPA ツールの採用は禁止するべき  
まずユーザーエクスペリエンスを考える、の週間の助けと鳴る

## ガードレール

React 採用を禁止することを話すと、世間知らずと思われて相手にされないかもしれない

英国政府のWebサイトが、プログレッシブエンハンスメントで作成されている事例を上げると納得を得られるかもしれない  
https://www.gov.uk/service-manual/technology/using-progressive-enhancement

お偉い人が言ってる & ポリシーにまとめられた証拠


## プログレッシブ・エンハンスメント

とは

- まず HTML でページを動作させるという考え
  - それがあって初めて CSS や JS を追加できるようになる
- 利点
  - サービスの堅牢性と高品質の保証
  - ブラウザやデバイスに関係なくサービスが機能する可能性が高くなる
    - CSS in JS の使用は禁止
  - 最も基本的な機能が動作し、ユーザーのコアのニーズを満たせる
  - セマンティックマークアップによるアクセシビリティの向上

- JS の代替
  - JS をなるべく使わないようにするためのハック
    - グラフ => ラスタライズやベクタライズして画像化 (CSRで組み立てない)
    - データをエクスポートして別アプリで分析する
- SPA フレームワークの禁止
  - ページ移動がブラウザではなくJSで処理される
    - 進む/戻るボタンで移動できない
    - ページ移動するときにフォーカスを処理できない
    - ネットワーク接続が中断されるとエラーから回復できない
    - ページ移動でのコンテキストの変化に気付けない

要するに、 SSR で純粋な HTML と CSS だけ出荷して JS をなるべく減らそうという考え方

### SPA vs Progressive Enhancement

- PE
  - サーバーアプリに状態がある
  - Ajax による部分的な更新
- SPA
  - クライアントアプリに状態がある
  - 楽観的更新の機能実装にはSPAが必須
  - オフライン動作 (メディア再生なども)
  - 生産性ツール・エディターなど (notion, jira など？)
    - 同じデータに対して短い時間で何回も更新を行うもの
    - ローカルデータの変更
  - 


## React を導入する根拠への反論

### 素早く開発する必要がある

といって React を採用する (or other js framework)

Webサイトのエラーや、バンドルサイズの制御や、etc...  
は結局プロジェクトの開発速度を上げてはいない

また、これらの負債の修復は苦痛で費用がかかる  
最悪のタイミングでサポートなしでやることになる。

move fast の段階で導入されたツールは簡単に修正できない  
最初は速く作れたのに、あとからだんだん深い理解と多くの操作時間を必要とする様になってくる

### Facebook で使われている

今日、我らが開発するプロジェクトは Facebook の 2010 年代当初に抱えていた問題とは全く違い、FBの成功に従うのは最悪な考え

あと、Facebook の運営しているサイトのパフォーマンスは普通に悪い  
(独占状態にあるから資金を燃やす余裕があるだけ)

### チームの人員がReactできるから...

React 開発者は Web 開発者でもある 
CSS, HTML, JS, DOM の世界で作業をしている

React はスタック内で最も代替可能なレイヤーで、テンプレートシステムに過ぎない(JSX)

Rails ERB に詳しい人が Django, Laravel, Wordpress の開発に移ることができるのに、React開発者だけできない？

Preact, Stencil, Svelte, Lit, FAST, Qwik などは簡単に習得できる

### React開発者は就職市場に多いので雇いやすい

コロナで人材が解雇されてあぶれているから、安く雇える理論

React を使う知識を持っていても、プロジェクトでそれを使う理由にはならない。  
ビルドツール、TS、JSX と HTML と JS の構文フォークの細かい違いのマスター をしている人は、別のシステムで働いても十分行ける。

Reactができる人は流行り廃りの激しい迷路で既に働いているので、「雇った人がすぐ働けるか？」ではなく「チームの寿命を通して最高の ROI をもたらすテクノロジーはなにか？」を考えるべき

React その他フレームワークの学習コストや問題対処のコストは非常に高く、流行しているからとだけで選ぶのはかなりヤバイ

ROI = Return of Investment

### みんな高性能スマホを持っている

https://infrequently.org/series/performance-inequality/

5Gは幻想、4Gは奇跡  
iPhone の i は inequality

意外と、高品質な回線を利用できる人口は限られているし、貧乏な人は高性能なスマホが変えない  
貧富の格差(インドとか)


### Reactは業界標準

といっても、React スタックにもかなりの多様性があって、この言葉はそれを隠している

- Class vs Function Component
- TS or else
- パッケージマネージャー (npm, yarn, pnpm, turbo)
- バンドラー (webpack, esbuild, swc, rollup)
- メタツール (vite, turbopack, nx)
- 状態管理ツール (redux, mobx, apollo, jotai, zustand, ...)
- CSSトランスパイル (tailwind, ...)
- CSS in JS (f**k)
- Create React App (長年 GetStarted として React ドキュメントに載っていたが削除された。いろいろ更新されてその時々で内容が違う)

### エコシステムが...

- Preact では機能しない？
- React のライブラリを使用するのに費やした時間とお金は？ => 時間を掛けず、エコシステムメリットを得ても継続的に利益をもたらすとは限らない
  - create-react-app のように頻繁に使われていても、非推奨になる可能性はある
  - CSS-in-JS は上手くいってない
    - 最終的に、package.json の devDependencies は消費者が所持することになり、不快なサプライズを回避するにはベンダーパッケージにして自分が保守する必要が出てくる
      - => エンジニアリング能力を担保にする高利ローンのようなもの
- 制御不能なコストを回避するには、UIツール、ビルドシステムその他の全てを徹底的に調査して承認すること
  - パッチ適用、改善を行えること
  - システムを全て所有すること
    - できないなら、システムのスタックの一部にするべきでない？ (でもフロントライブラリを使わずSSRでやる場合でもいちいちやってられないしな。。。)

### Next.js は高速だ

11ty, Astro など HTML ファーストなサイトのほうが Next.js よりパフォーマンスが大幅に高い(Next.js はいうほどパフォーマンスが高くない)

- Next.js はスケールしない
- React の足かせを背負っている
- 遅延ロードJSの巨大なデフォルトペイロード
- Vercel の独自APIが多すぎて、最適なパフォーマンスを出そうとすると Vercel にロックされるので実質プロプライエタリソフト
  - ベンダーロックイン、多額の資金を失う近道


### React Native

- 常に手動で調整する必要のある低速のモバイルアプリを作るのには使える。
- ひどいWebサイトを作るのにも使える。
  - bluesky が React Native を採用してるが、サイトのパフォーマンスが悪い
- Airbnb も RN から撤退して、ネイティブ開発に投資している

Web と同じコードベースを魅力的なモバイルアプリにしたいなら、
- Trusted Web Activities
- PWA Builder
- Capacitor or Cordova
がオススメ







## 参照
Real User Monitoring : 実際のユーザー環境にスクリプトを埋め込んで、パフォーマンスなどを監視すること
Web Vitals: https://web.dev/articles/vitals?hl=ja

### Javascript dos and donts : JS ですべきこと、すべきでないこと
https://muan.co/posts/javascript

基本使うな

- JS でないとできないUI
  - HTMLが提供していない場合は、提供していない理由がある。HTMLの一部でない理由を考えるべき
    - 自分で実装する場合 -> 技術負債、ブラウザ互換性、メンテンナンスコスト に気をつけてJSを使う

Github のフロントメンバーは、 Microsoft が React をゴリ推したのでほとんどやめてしまったらしい  
「HTMLは2005年のように書け」  

フレームワークやnpmの知識は必須ではなく、ウェブの仕組みを知っていてHTMLやCSSを上手く使ったり、ソースを遡ってコードを読めることが重要

## Gordian knot

ゴルディアスの結び目

手に負えないような難問を、誰も思いつかなかった大胆な方法で解決してしまうこと

## Zero
Web app (server) と DB の間におくサーバー

WebApp (server) <-> Zero Client <-> Zero cache <-> DB(SQL)
https://zero.rocicorp.dev/

## Y js
コラボレーションアプリケーション作成のためのモジュール
p2p!
https://docs.yjs.dev/